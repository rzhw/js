/**
 * glyr 0.4.9
 * Copyright (c) 2009-2010 a2h
 * http://github.com/a2h/js
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

var glyrCounter=0;var glyrTimers={};(function($){$.fn.glyr=function(options){if(options.todo!="update"){var curimg=0;var settings=$.extend({prefix:"gallery",images:[],showBottom:true,showTabs:true,showCaption:true,allowClick:true,speed:500,delay:3000},options);var csssource=options.css;var errors=[];if(!settings.images.length){errors.push("<code>options.images</code> is either not an array or is empty")}if(typeof(options.css)!="object"){if(options.css!="defined"){errors.push("<code>options.css</code> must be an object or set to <code>'defined'</code>")}else{options.css={}}}if(options.prefix=="glyr-prefix"){errors.push("<code>options.prefix</code> cannot be set to <code>'glyr-prefix'</code>")}settings.css=$.extend({background:"#808080",color:"#fff",width:"640px",height:"480px",padding:"6px"},options.css);settings.css.tabs=$.extend({"background-off":"#C5D7F7","background-on":"#74A3E0",width:"48px",height:"16px"},settings.css.tabs);var glyr=$(this).addClass(settings.prefix).attr("data-id",glyrCounter);glyrCounter++;if(csssource=="defined"){$.each(settings.css,function(k){if(k!="tabs"){if(k!="padding"){settings.css[k]=$(glyr).css(k)}else{settings.css.padding=$(glyr).css("padding-bottom")}}})}$(glyr).css(settings.css).css("height","auto");if(!errors.length){$(glyr).append('<div class="'+settings.prefix+'-images"></div>');$(glyr).append('<div class="'+settings.prefix+'-bottom"><div class="'+settings.prefix+'-tabs" style="float:left;"></div><div class="'+settings.prefix+'-title" style="float:right;"></div><div style="clear:both;"></div></div>');$(glyr).find("."+settings.prefix+"-bottom").css("margin-top",settings.css.padding);$('<div class="'+settings.prefix+'-current">0</div>').appendTo(glyr).hide();$('<div class="'+settings.prefix+'-speed">'+settings.speed+"</div>").appendTo(glyr).hide();$('<div class="'+settings.prefix+'-delay">'+settings.delay+"</div>").appendTo(glyr).hide();$('<div class="glyr-prefix">'+settings.prefix+"</div>").appendTo(glyr).hide();var glyrImages=$(glyr).find("."+settings.prefix+"-images").css("overflow","hidden");var glyrTabs=$(glyr).find("."+settings.prefix+"-tabs").css("height",settings.css.tabs.height);var glyrTitle=$(glyr).find("."+settings.prefix+"-title").css("height",settings.css.tabs.height);$(glyrImages).css({position:"relative",width:settings.css.width,height:settings.css.height});$(glyrTabs).css({"float":"left",height:settings.css.tabs.height});$(glyrTitle).css({"float":"right",height:settings.css.tabs.height});var imgcount=settings.images.length;for(i=0;i<imgcount;i++){var temptab=$("<div>").appendTo(glyrTabs).addClass((settings.prefix+"-tab")+" "+(settings.prefix+"-tab-"+i)+" "+(i==0?settings.prefix+"-tab-on":settings.prefix+"-tab-off")).attr("data-id",i).css({"float":"left",background:i==0?settings.css.tabs["background-on"]:settings.css.tabs["background-off"],width:settings.css.tabs.width,height:settings.css.tabs.height,"font-size":0,"margin-right":settings.css.padding});if(settings.allowClick){$(temptab).css("cursor","pointer").click(function(){var tochange=$(this).closest("."+settings.prefix);$(tochange).glyr({todo:"update",to:$(this).attr("data-id")})})}temptab=null;$("<img>").appendTo(glyrImages).attr(settings.images[i]).addClass(settings.prefix+"-image "+settings.prefix+"-image-"+i).css({position:"absolute",display:i==0?"block":"none","margin-top":0,width:settings.css.width,height:settings.css.height});if(settings.images[i].alt){$(glyr).find("."+settings.prefix+"-image-"+i).attr("alt",settings.images[i].alt);if(i==0){$(glyrTitle).html(settings.images[i].alt)}}}if(!settings.showBottom||(!settings.showTabs&&!settings.showCaption)){$(glyr).find("."+settings.prefix+"-bottom").hide()}if(!settings.showTabs&&settings.showCaption){$(glyrTabs).hide()}if(!settings.showCaption&&settings.showTabs){$(glyrTitle).hide()}if(settings.images.length>1){setTimeout(function(){$(glyr).glyr({todo:"update",to:1})},settings.delay)}}else{var errorsstr="";$.each(errors,function(i,v){errorsstr+="<li>"+v+"</li>"});$(glyr).html("<strong>Oops, glyr encountered errors! Fix them and you should be good to go.</strong><ul>"+errorsstr+"</ul>")}}else{var prefix=$(this).find(".glyr-prefix").text();var showBottom=$(this).find("."+prefix+"-tabs").length?true:false;var speed=parseInt($(this).find("."+prefix+"-speed").text());var cur=parseInt($(this).find("."+prefix+"-current").text());var delay=parseInt($(this).find("."+prefix+"-delay").text());var next=options.to;var nextnext=next==$(this).find("."+prefix+"-image").length-1?0:next+1;var tabon=$(this).find("."+prefix+"-tab-"+cur).css("background");var taboff=$(this).find("."+prefix+"-tab-"+next).css("background");if(showBottom){$(this).find("."+prefix+"-tab-"+cur).css("background",taboff)}$(this).find("."+prefix+"-image-"+cur).fadeOut(speed);$(this).find("."+prefix+"-image-"+next).fadeIn(speed);if(showBottom){$(this).find("."+prefix+"-tab-"+next).css("background",tabon);$(this).find("."+prefix+"-title").html($(this).find("."+prefix+"-image-"+next).attr("alt"))}$(this).find("."+prefix+"-current").text(next);var tochange=this;if(glyrTimers[$(this).attr("data-id")]){clearTimeout(glyrTimers[$(this).attr("data-id")])}glyrTimers[$(this).attr("data-id")]=setTimeout(function(){$(tochange).glyr({todo:"update",to:nextnext})},delay)}}})(jQuery);