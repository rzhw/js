/**
 * glyr 0.4.9
 * Copyright (c) 2009-2010 a2h
 * http://github.com/a2h/js
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

var glyrCounter=0,glyrTimers={},glyrBaseStyles={}; (function(a){a.fn.glyr=function(e){if(e.todo!="update"){var b=a.extend({prefix:"",images:[],statusPosition:"after",showTabs:true,showCaption:true,baseStyle:true,allowClick:true,speed:500,delay:3E3},e),c=[];b.images.length||c.push("<code>options.images</code>  is either not an array or is empty");e.prefix=="glyr-prefix"&&c.push("<code>options.prefix</code>  cannot be set to <code>'glyr-prefix'</code>");if(b.baseStyle)if(!glyrBaseStyles[b.prefix]){glyrBaseStyles[b.prefix]=true;var g='<style type="text/css">'; a.each([{selector:".glyr",css:{background:"#808080",color:"#fff",width:"640px",height:"480px",padding:"6px"}},{selector:"."+b.prefix+"tabs",css:{"float":"left"}},{selector:"."+b.prefix+"tab",css:{"float":"left",width:"48px",height:"16px"}},{selector:"."+b.prefix+"tab-on",css:{background:"#74A3E0"}},{selector:"."+b.prefix+"tab-off",css:{background:"#C5D7F7"}},{selector:"."+b.prefix+"caption",css:{"float":"right",height:"16px"}}],function(l,j){g+=j.selector+"{";a.each(j.css,function(o,p){g+=o+":"+p+ ";"});g+="}"});g+="</style>";a("head").prepend(g)}var f=a(this).addClass("glyr").attr("data-id",glyrCounter);glyrCounter++;e=a('<div class="'+b.prefix+'images"></div>').css("overflow","hidden").appendTo(f);var d=a(e).css("width"),h=a(e).css("height");a(f).css({position:"relative",width:d,height:"auto"});if(c.length){var m="";a.each(c,function(l,j){m+="<li>"+j+"</li>"});a(f).html("<strong>Oops, glyr encountered errors! Fix them and you should be good to go.</strong><ul>"+m+"</ul>")}else{c=a('<div class="'+ b.prefix+'status"><div class="'+b.prefix+'tabs"></div><div class="'+b.prefix+'caption" style="float:right;"></div><div style="clear:both;"></div></div>').appendTo(f);b.statusPosition=="before"&&a(c).css("margin-bottom",a(f).css("padding-top"));b.statusPosition=="after"&&a(c).css("margin-top",a(f).css("padding-bottom"));b.statusPosition=="top"&&a(c).css({position:"absolute",top:a(f).css("padding-top").replace("px","")});b.statusPosition=="bottom"&&a(c).css({position:"absolute",bottom:a(c).height()}); if(b.statusPosition=="top"||b.statusPosition=="bottom")a(c).css({width:a(e).width()-a(c).css("margin-left").replace("px","")-a(c).css("margin-right").replace("px","")-a(c).css("padding-left").replace("px","")-a(c).css("padding-right").replace("px","")});a('<div class="'+b.prefix+'current">0</div>').appendTo(f).hide();a('<div class="'+b.prefix+'speed">'+b.speed+"</div>").appendTo(f).hide();a('<div class="'+b.prefix+'delay">'+b.delay+"</div>").appendTo(f).hide();a('<div class="glyr-prefix">'+b.prefix+ "</div>").appendTo(f).hide();c=a(f).find("."+b.prefix+"tabs");var k=a(f).find("."+b.prefix+"caption");a(e).css({position:"relative",width:d,height:h});var q=b.images.length;for(i=0;i<q;i++){var n=a("<div>").appendTo(c).addClass(b.prefix+"tab "+(b.prefix+"tab-"+i)+" "+(i==0?b.prefix+"tab-on":b.prefix+"tab-off")).attr("data-id",i).css({"font-size":0,"margin-right":a(f).css("padding-bottom")});b.allowClick&&a(n).css("cursor","pointer").click(function(){var l=a(this).closest(".glyr");a(l).glyr({todo:"update", to:a(this).attr("data-id")})});n=null;a("<img>").appendTo(e).attr(b.images[i]).addClass(b.prefix+"image "+b.prefix+"image-"+i).css({position:"absolute",display:i==0?"block":"none","margin-top":0,width:d,height:h});if(b.images[i].alt){a(f).find("."+b.prefix+"image-"+i).attr("alt",b.images[i].alt);i==0&&a(k).html(b.images[i].alt)}}if(b.statusPosition=="hide"||!b.showTabs&&!b.showCaption)a(f).find("."+b.prefix+"bottom").hide();!b.showTabs&&b.showCaption&&a(c).hide();!b.showCaption&&b.showTabs&&a(k).hide(); b.images.length>1&&setTimeout(function(){a(f).glyr({todo:"update",to:1})},b.delay)}}else{b=a(this).attr("data-id");d=a(this).find(".glyr-prefix").text();h=parseInt(a(this).find("."+d+"speed").text());c=parseInt(a(this).find("."+d+"current").text());k=parseInt(a(this).find("."+d+"delay").text());e=e.to;var r=e==a(this).find("."+d+"image").length-1?0:e+1;a(this).find("."+d+"tab-"+c).removeClass(d+"tab-on");a(this).find("."+d+"tab-"+c).addClass(d+"tab-off");a(this).find("."+d+"image-"+c).fadeOut(h); a(this).find("."+d+"image-"+e).fadeIn(h);a(this).find("."+d+"tab-"+e).removeClass(d+"tab-off");a(this).find("."+d+"tab-"+e).addClass(d+"tab-on");a(this).find("."+d+"caption").html(a(this).find("."+d+"image-"+e).attr("alt"));a(this).find("."+d+"current").text(e);var s=this;glyrTimers[b]&&clearTimeout(glyrTimers[b]);glyrTimers[b]=setTimeout(function(){a(s).glyr({todo:"update",to:r})},k)}}})(jQuery);